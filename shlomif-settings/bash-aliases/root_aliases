#!/bin/bash

# For GNU screen to use a different key-binding
alias screen='screen -e "^^6"'

_sys()
{
    echo "$@"
    "$@"
}

u()
{
    local common_args
    common_args="--auto --keep --resume --noclean --downloader wget --wget-options -c"
    ( cd $HOME ;
    if test "$#" -eq 0 ; then
        _sys urpmi $common_args --auto-select;
    else
        _sys urpmi $common_args "$@" ;
    fi
    )
}

uu()
{
    (cd $HOME ; urpmi.update -a)
}

wu()
{
    while ! u ; do true ; done
}

function normalize_perlmod()
{
    local pm="$1"
    shift

    echo "$pm" | perl -p -e 's/perl-//; s{[-/]}{::}g; s{\.pm(\n?)\z}{$1}'
}

function rpmize_perlmod()
{
    local pm="$1"
    shift
    echo "perl($(normalize_perlmod "$pm"))"
}

function debianize_perlmod()
{
    local pm="$1"
    shift

    echo "lib$(normalize_perlmod "$pm" | perl -pe 's/::/-/g;$_=lc($_)')-perl"
}

up()
{
    urpmi --auto $(perlmf as_rpm_colon "$@")
}

function c()
{ 
    local pm="$1"
    shift

    cpan2dist --verbose --format=CPANPLUS::Dist::Mdv \
        --install --timeout 0 "$(normalize_perlmod "$pm")" ; 
}

function qp()
{ 
    local pm="$1"
    shift

    urpmq --whatprovides "$(rpmize_perlmod "$pm")" ; 
}

function cp_to_shlomif()
{
    local dest
    dest=~shlomif/progs/Rpms/SRPMS/
    cp -f /root/rpmbuild/SRPMS/*.src.rpm "$dest" ; 
    chown shlomif.shlomif "$dest"/*.src.rpm
}

function pap()
{
    local pm="$1"
    shift

    apt-get install "$(debianize_perlmod "$pm")" ;
}

e()
{
    urpme "$@"
}

# urpme orphans.
eo()
{
    e --auto-orphans
}
